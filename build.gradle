plugins {
    id 'com.github.johnrengelman.shadow' version '7.1.2'
    id 'kr.entree.spigradle' version '2.4.2'
    id 'java'
    id "xyz.jpenilla.run-paper" version "2.1.0"
}

group 'cc.happyareabean'
version '1.1.2'

sourceCompatibility = JavaLanguageVersion.of(8)
targetCompatibility = JavaLanguageVersion.of(8)

compileJava.options.encoding = 'UTF-8'

archivesBaseName = rootProject.name

def libsPackage = group + ".sjm.libs."

repositories {
    mavenCentral()

    //Added spigot repository
    maven {
        name = 'Spigot'
        url = 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/'
    }

    //Added md5's repository to add the missing BungeeCord-Chat api
    maven {
        name = 'BungeeCord-Chat'
        url = 'https://oss.sonatype.org/content/repositories/snapshots'
    }

    maven {
        url = 'https://repo.extendedclip.com/content/repositories/placeholderapi/'
    }

    maven {
        name = "sonatype-oss-snapshots1"
        url = "https://s01.oss.sonatype.org/content/repositories/snapshots/"
    }

    maven { url 'https://jitpack.io' }

    //Add your repositories here
    mavenLocal()
}

ext {
    //Define one of the supported mc versions
    mcVersion = '1.20.1'
}

dependencies {
    //Adds the spigot api to your plugin
    compileOnly "org.spigotmc:spigot-api:${mcVersion}-R0.1-SNAPSHOT"

    //Add your dependencies here
    compileOnly 'org.projectlombok:lombok:1.18.24'
    annotationProcessor 'org.projectlombok:lombok:1.18.24'

    testCompileOnly 'org.projectlombok:lombok:1.18.24'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.24'

    compileOnly 'me.clip:placeholderapi:2.11.1'

    implementation "net.kyori:adventure-api:4.14.0"
    implementation "net.kyori:adventure-text-minimessage:4.14.0"
    implementation "net.kyori:adventure-platform-bukkit:4.3.0"

    implementation "com.squareup.okhttp3:okhttp:4.10.0"

    implementation 'com.github.Revxrsal.Lamp:bukkit:3.1.8'
    implementation 'com.github.Revxrsal.Lamp:common:3.1.8'

    implementation("de.exlll:configlib-core:2.3.0")

    implementation 'org.bstats:bstats-bukkit:3.0.0'

}

import com.github.jengelman.gradle.plugins.shadow.tasks.ConfigureShadowRelocation

tasks.register('relocateShadowJar', ConfigureShadowRelocation) {
    target = tasks.shadowJar
    prefix = project.getGroup().toString() + ".sjm.libs" // Default value is "shadow"

}

tasks.shadowJar.dependsOn tasks.relocateShadowJar

spigot {
    // The 'name' and 'version' will be set to project.version and project.name,
    // But we may set those manually.
    apiVersion '1.13'
    excludeLibraries = ['*']
    softDepends 'PlaceholderAPI'
    authors 'HappyAreaBean'
    permissions {
        'sjm.admin' {
            description = 'Allows to use SimpleJoinMessage commands.'
            defaults = 'op'
        }
    }
}

processResources {
    project.properties.put("version", this.version)
    expand project.properties
}

def runDirectoryDir = project.hasProperty('runPaper.runDirectory') ? project.getProperty('runPaper.runDirectory') : "${project.rootProject.projectDir}/working"
def runServerJar = project.hasProperty('runPaper.serverJar') ? project.getProperty('runPaper.serverJar') : null

tasks {
    runServer {
        // Configure the Minecraft version for our task.
        // This is the only required configuration besides applying the plugin.
        // Your plugin's jar (or shadowJar if present) will be used automatically.
        minecraftVersion(mcVersion)
        if (runServerJar != null)
            serverJar(runDirectory.file(runServerJar as String))
        runDirectory.set(file(runDirectoryDir))
    }
    shadowJar {
        archiveClassifier.set('')
    }
}
